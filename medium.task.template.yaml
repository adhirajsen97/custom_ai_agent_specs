# medium.task.template.yaml
# ─────────────────────────────────────────────────────────────
# SIZE RULES (medium): 3–8 files, ≤1 new module, 1–2 sessions
# Autonomy default: plan-then-confirm
# Human checkpoints: after plan pass, before execution begins
#
# BLAST RADIUS NOTE:
# If blast_radius is "core" → autonomy is forced to human-in-loop
# regardless of this declaration. State override in plan output.
# ─────────────────────────────────────────────────────────────

task_id: T-YYYYMMDD-TODO       # auto-stamped by new-task.sh
size: medium
autonomy: plan-then-confirm    # agent produces plan → human approves → agent executes

title: "TODO: Short imperative title"

problem:
  summary: >
    TODO: 1–2 sentences — what is broken or missing?
  goal: >
    TODO: 1–2 sentences — what does a complete, correct solution look like?
  non_goals:
    - "TODO: Explicitly out of scope item 1"
    - "TODO: Explicitly out of scope item 2"

acceptance_criteria:
  - criterion: "TODO: Criterion 1 — observable and testable, not vague"
    test_names:
      - "TODO: exact test name that validates this criterion"
  - criterion: "TODO: Criterion 2"
    test_names:
      - "TODO: exact test name"
  - criterion: "TODO: Criterion 3 — must include a test coverage criterion"
    test_names:
      - "TODO: exact test name"
  - criterion: "TODO: Criterion 4 — must include a logging/observability criterion"
    test_names:
      - "TODO: exact test name"
  - criterion: "Existing API contract for TODO:endpoint is unchanged"
    test_names:
      - "TODO: regression test name proving contract is preserved"

constraints:
  no_new_dependencies: true
  preserve_api_contract: true
  touch_only_listed_files: true
  allowed_additions: []

  # ── Dependency rule ──────────────────────────────────────
  # To add a dependency, fill this out and get explicit approval:
  # allowed_additions:
  #   - name: "TODO: package-name"
  #     version: "TODO: semver range"
  #     reason: "TODO: Why this is necessary and not replaceable"
  #     already_in_repo: false       # true = already used elsewhere
  #     approved_by: "TODO: name"
  #     approved_date: "TODO: YYYY-MM-DD"

inputs_outputs:
  inputs:
    - "TODO: Input 1 — method, path, or data shape"
    - "TODO: Input 2 (if applicable)"
  outputs:
    - "TODO: Output 1 — what persists or returns"

# ── Risk Assessment ──────────────────────────────────────────
# blast_radius: isolated | peripheral | core
#   isolated  — self-contained, no shared dependencies
#   peripheral — touches shared utilities or mid-tier services
#   core      — touches auth, DB schema, entry points, core libs
#               → forces human-in-loop regardless of size/autonomy setting
#
# risk_level and blast_radius are independent:
#   risk_level: medium + blast_radius: core → human-in-loop autonomy enforced
#   risk_level: high (any blast_radius) → human-in-loop autonomy enforced
# ─────────────────────────────────────────────────────────────
risk_level: low                # low | medium | high
blast_radius: peripheral       # isolated | peripheral | core

# security_reviewer: required when any file_change_plan path matches a risk-trigger pattern
# (auth/, db/migrations/, .env*, package.json, middleware/, etc.).
# See 00_policy.spec.md — Automatic Risk Escalation Triggers for the full list.
# Leave "" if no risk-trigger paths exist in file_change_plan.
security_reviewer: ""

# risk_override: only use if blast_radius is core but risk is genuinely low.
# ALL FOUR fields are required together when using a risk_override.
# risk_override: justified
# risk_override_reason: "TODO: explain"
# risk_override_approved_by: "TODO: name"
# risk_override_date: "TODO: YYYY-MM-DD"

# ── Cross-task dependencies ──────────────────────────────────
# List task_ids that must be completed and merged before this task can run.
# validate-task.sh checks that each listed task has a confirmed handoff in specs/archive/.
# Leave empty if no dependencies exist.
depends_on_tasks: []
# depends_on_tasks:
#   - "T-20260220-add-types"    # must be merged first — this task uses its new types

rollback:
  files_to_revert:
    - "TODO: path/to/service.ts"
    - "TODO: path/to/service.test.ts"
  migration_required: false
  migration_rollback: null     # populate if migration_required: true:
    # steps:
    #   - "Run: npm run db:rollback -- --migration=<name>"
    #   - "Verify: row count matches pre-migration snapshot"
  feature_flag: null           # populate if a feature flag controls this change:
    # name: "TODO: flag-name"
    # default_state: "off"
    # rollback_action: "Set flag to off in config service"
  notes: "TODO: Describe revert steps in plain English"

# ── Toolchain overrides (only if repo differs from CONVENTIONS.md) ──
# toolchain_overrides:
#   test_command: "npx vitest run"
#   lint_command: "npx eslint ."
#   typecheck_command: "npx tsc --noEmit"
